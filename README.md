# Threat Intelligence 기반 IOC 매칭 및 위협 점수화 파이프라인

이 프로젝트는 보안 로그를 단순히 저장하거나 조회하는 수준을 넘어서, **Threat Intelligence(IOC 정보)** 와 실제 로그를 연결해 “어떤 IP가 얼마나 위협적인지”를 정량적으로 평가하는 흐름을 한 번에 구현한 작업입니다. 구조는 단순하지만, 보안 관제(SOC)에서 실제로 쓰는 사고 방식을 그대로 옮겨 온 형태입니다. 기본 아이디어는 *“외부에서 악성으로 알려진 IP 정보(IoC)를 모아 정리한 뒤, 실제 로그와 매칭해서 위험도를 점수로 산출한다”*입니다.

먼저 모의 Threat Intelligence 데이터를 생성합니다. AbuseIPDB·VirusTotal·OTX 같은 외부 소스를 흉내 내서, `indicator(IP 주소)`, `threat_type`, `source`, `base_score`, `first_seen` 등의 필드를 가진 테이블을 만들어 둡니다. 이 데이터는 실제 TI Feed의 구조를 본떠서 설계했고, 점수(`base_score`)는 악성 IP가 보통 가지는 평판 점수를 가정해 1~100 범위에서 난수 기반으로 구성했습니다. 이후 이 IOC 목록을 정규화하면서 IP 포맷, 대소문자, 공백, null 값 등을 맞춰줘서 나중에 로그와 매칭될 때 문제가 없도록 합니다.

보안 로그 쪽은 따로 생성한 Spark 기반 로그 프로젝트와 동일한 철학으로, `src_ip`, `dst_ip`가 모두 문자열 형태로 정리된 상태입니다. 여기서 핵심은 `src_ip`와 `dst_ip`를 각각 IOC 테이블과 조인해서 **“이 IP가 공격자 쪽인지, 피해자 쪽인지, 또는 두 경우 모두인지”** 를 구분하는 것입니다. 두 방향 매칭을 모두 수행한 뒤, 실제로 IOC에 걸린 이벤트만 필터링하면, 평범한 로그 수천 건 중에서도 위험 신호만 뽑아 볼 수 있습니다.

다음 단계는 단순 매칭을 넘어서 **위협 점수화(threat scoring)** 를 적용하는 부분입니다. IOC에서 제공된 `base_score`를 기본값으로 삼고, 여기에 로그 자체에서 얻을 수 있는 요소들을 추가로 고려합니다. 예를 들어 한 IP가 등장한 이벤트 수(`event_count`)가 많을수록, 그리고 로그 발생 시점이 최신일수록 위험도가 더 높다고 보고, 지수 감쇠 기반의 “최근성 가중치(recency weight)”를 계산해 점수에 반영했습니다. 최종 스코어는 `base_score`, `event_count`, `recency_weight`를 조합해서 만들었고, 그 결과를 내림차순으로 정렬하면 “현재 로그에서 가장 위험하게 움직인 IP Top N”을 바로 확인할 수 있습니다. 분석 결과는 CSV로 저장하고, 상위 IP는 막대 그래프로 가볍게 시각화해서 직관적으로 파악할 수 있게 했습니다.

전체 코드는 Google Colab 기준으로 설계되어 있어 별도의 환경 설정이 필요 없고, 기본적으로 모의 TI 데이터를 사용하기 때문에 API Key 없이도 전체 파이프라인이 끝까지 동작합니다. 원한다면 VirusTotal API를 붙여서 실제 평판 정보를 사용할 수도 있도록 샘플 함수도 포함해 두었습니다. 이 프로젝트는 “보안 로그 처리”와 “Threat Intelligence 활용”을 자연스럽게 잇는 형태라, 단순 이상치 탐지보다 실전 보안 관제에 가까운 흐름을 담고 있습니다. 실제 SOC에서 수행하는 IOC 분석→로그 매칭→위협 수준 계산의 축소판이라고 보시면 됩니다.
